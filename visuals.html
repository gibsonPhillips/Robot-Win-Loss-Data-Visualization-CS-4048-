<!DOCTYPE html>
<div id="container">

    <head>
        <link rel="stylesheet" type="text/css" href="css/style.css" />
        <link rel="stylesheet" type="text/css" href="css/toggle.css" />
        <link rel="stylesheet" type="text/css" href="css/visuals.css" />
        <link rel="stylesheet" type="text/css" href="css/pieChart.css" />


        <!-- Include D3.js library -->
        <script src="https://d3js.org/d3.v7.min.js"></script>

        <title> Battle Bots Visuals </title>
        <!-- <script type="module">
            import { sortData } from "./scripts/csvReader.js";
            console.log(d3);
            var data;
            //console.log(data = await sortData(["Vertical Spinner","Drum"],["2WD","4WD"],["30lb","3lb"]));
            // create 2 data_set

            data = await sortData(["Hammersaw",
                "Vertical Spinner",
                "Drum",
                "Undercutter",
                "Midcutter",
                "Grappler",
                "Flamethrower",
                "Drum Spinner",
                "Beater",
                "Hammer",
                "Full Body Spinner",
                "Flipper",
                "Shell Spinner",
                "Lifter",
                "Overhead",
                "MeltyBrain",
                "Horizontal Spinmer",
                "Crusher",
                "Thwack",
                "Ring Spinner",
                "Hammer Saw",
                "Flail"], ["2WD", "Tread", "4WD", "Shuffler", "8WD", "Bristle Drive", "Swerve", "Drive"], ["30lb", "12lb", "3lb"]);
            console.log(data);

            // var data = await sortData(["Hammersaw"],["2WD", "Tread","4WD","Shuffler","8WD","Bristle Drive","Swerve","Drive"],["30lb","12lb","3lb"]);
            // var data2 = await sortData(["Vertical Spinner"],["2WD", "Tread","4WD","Shuffler","8WD","Bristle Drive","Swerve","Drive"],["30lb","12lb","3lb"]);
            // console.log(data);
            // console.log(data2);

            //test data
            // export var data = [
            //   { group: "A", value: 4 },
            //   { group: "B", value: 16 },
            //   { group: "C", value: 8 },
            //   { group: "D", value: 20 }
            // ];

            // set the dimensions and margins of the graph
            var margin = { top: 30, right: 30, bottom: 70, left: 60 },
                width = 600 - margin.left - margin.right,
                height = 400 - margin.top - margin.bottom;

            // append the svg1 object to the body of the page
            var svg1 = d3.select("#barGraph1")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // X axis
            var x = d3.scaleBand()
                .range([0, width])
                .domain(Object.keys(data["Drum"]))
                .padding(0.5);
            var xAxis = svg1.append("g")
                .attr("class", "xAxis")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x).tickValues([]));

            xAxis.select("path").remove();

            var yHeight = findMax("Hammersaw", "Hammersaw") * 1.1;
            // Add Y axis
            var y = d3.scaleLinear()
                .domain([-yHeight, yHeight])
                .range([height, 0]);
            var yAxis = svg1.append("g")
                .attr("class", "yAxis")
                .call(d3.axisLeft(y));

            // append the svg1 object to the body of the page
            var svg2 = d3.select("#barGraph2")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // X axis
            var x2 = d3.scaleBand()
                .range([0, width])
                .domain(Object.keys(data["Hammersaw"]))
                .padding(0.5);
            var xAxis2 = svg2.append("g")
                .attr("class", "xAxis")
                .attr("transform", "translate(0," + height + ")")
                .call(d3.axisBottom(x2).tickValues([]));

            xAxis2.select("path").remove();

            // Add Y axis
            var y2 = d3.scaleLinear()
                .domain([-yHeight, yHeight])
                .range([height, 0]);
            var yAxis2 = svg2.append("g")
                .attr("class", "yAxis")
                .call(d3.axisLeft(y2));

            svg1.append('line')
                .style("stroke", "white")
                .style("stroke-width", 0.5)
                .attr("x1", 0)
                .attr("y1", y(0))
                .attr("x2", width)
                .attr("y2", y(0));
            svg2.append('line')
                .style("stroke", "white")
                .style("stroke-width", 0.5)
                .attr("x1", 0)
                .attr("y1", y(0))
                .attr("x2", width)
                .attr("y2", y(0));

            var u;
            var v;
            // A function that create / update the plot for a given variable:
            async function updateBarGraphs(weapon1, weapon2, drive, category) {
                console.log("Hi :)")
                data = await sortData([weapon1, weapon2], drive, category);
                svg1.selectAll("rect").remove();
                svg2.selectAll("rect").remove();
                svg1.select(".xAxis").remove();
                svg2.select(".xAxis").remove();
                svg1.select(".yAxis").remove();
                svg2.select(".yAxis").remove();
                yHeight = findMax(weapon1, weapon2) * 1.1;

                var y = d3.scaleLinear()
                    .domain([-yHeight, yHeight])
                    .range([height, 0]);
                yAxis = svg1.append("g")
                    .attr("class", "yAxis")
                    .call(d3.axisLeft(y));

                var y2 = d3.scaleLinear()
                    .domain([-yHeight, yHeight])
                    .range([height, 0]);
                yAxis2 = svg2.append("g")
                    .attr("class", "yAxis")
                    .call(d3.axisLeft(y2));

                if (data[weapon1]) {
                    // X axis
                    x = d3.scaleBand()
                        .range([0, width])
                        .domain(Object.keys(data[weapon1]))
                        .padding(0.5);
                    xAxis = svg1.append("g")
                        .attr("class", "xAxis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(d3.axisBottom(x));

                    u = svg1.selectAll("rect")
                        .data(Object.entries(data[weapon1]));

                    //The Wins
                    u
                        .enter()
                        .append("rect")
                        .attr("x", function (d) { return x(d[0]); })
                        .attr("y", function (d) { return y(d[1].W); })
                        .attr("width", x.bandwidth())
                        .attr("height", function (d) { return height - y(d[1].W - yHeight); })
                        .attr("fill", "#69b3a2");

                    //The losses
                    u
                        .enter()
                        .append("rect")
                        .attr("x", function (d) { return x(d[0]); })
                        .attr("y", function (d) { return y(0); })
                        .attr("width", x.bandwidth())
                        .attr("height", function (d) { return height - y(d[1].L - yHeight); })
                        .attr("fill", "#da845f");
                } else {
                    // X axis
                    x = d3.scaleBand()
                        .range([0, width])
                        .domain(["Summary"])
                        .padding(0.5);
                    xAxis = svg1.append("g")
                        .attr("class", "xAxis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(d3.axisBottom(x));
                }

                if (data[weapon2]) {
                    // X axis
                    x2 = d3.scaleBand()
                        .range([0, width])
                        .domain(Object.keys(data[weapon2]))
                        .padding(0.5);
                    xAxis2 = svg2.append("g")
                        .attr("class", "xAxis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(d3.axisBottom(x2));

                    v = svg2.selectAll("rect")
                        .data(Object.entries(data[weapon2]));

                    //The wins
                    v
                        .enter()
                        .append("rect")
                        .attr("x", function (d) { return x2(d[0]); })
                        .attr("y", function (d) { return y2(d[1].W); })
                        .attr("width", x2.bandwidth())
                        .attr("height", function (d) { return height - y2(d[1].W - yHeight); })
                        .attr("fill", "#69b3a2");

                    //The losses
                    v
                        .enter()
                        .append("rect")
                        .attr("x", function (d) { return x2(d[0]); })
                        .attr("y", function (d) { return y2(0); })
                        .attr("width", x2.bandwidth())
                        .attr("height", function (d) { return height - y(d[1].L - yHeight); })
                        .attr("fill", "#da845f");
                }
                else {
                    // X axis
                    x2 = d3.scaleBand()
                        .range([0, width])
                        .domain(["Summary"])
                        .padding(0.5);
                    xAxis2 = svg2.append("g")
                        .attr("class", "xAxis")
                        .attr("transform", "translate(0," + height + ")")
                        .call(d3.axisBottom(x2));
                }

                xAxis.select("path").remove();

                xAxis2.select("path").remove();
            }
            window.update = updateBarGraph;

            function findMax(weapon1, weapon2) {
                console.log(data[weapon1]);
                var max = 1;
                if (data[weapon1]) {
                    var weaponData1 = Object.entries(data[weapon1]);
                    if (max < weaponData1[weaponData1.length - 1][1].W) {
                        max = weaponData1[weaponData1.length - 1][1].W;
                    }
                    if (max < weaponData1[weaponData1.length - 1][1].L) {
                        max = weaponData1[weaponData1.length - 1][1].L;
                    }
                }
                if (data[weapon2]) {
                    var weaponData2 = Object.entries(data[weapon2]);
                    if (max < weaponData2[weaponData2.length - 1][1].W) {
                        max = weaponData2[weaponData2.length - 1][1].W;
                    }
                    if (max < weaponData2[weaponData2.length - 1][1].L) {
                        max = weaponData2[weaponData2.length - 1][1].L;
                    }
                }
                return max;
            }

            // Initialize the plot with the first dataset
            updateBarGraphs("Hammersaw", "Hammersaw", ["2WD", "Tread", "4WD", "Shuffler", "8WD", "Bristle Drive", "Swerve", "Drive"], ["30lb", "12lb", "3lb"]);
            function c(filePath) {
                // Split the file path by backslash ("\") and get the last part
                var parts = filePath.split("\\");
                var weaponName = parts[parts.length - 1].replace(".gif", ""); // Remove the file extension if needed
                return weaponName.replace("final ", ""); // Remove "final" from the weapon name
            }

            document.addEventListener("DOMContentLoaded", function () {
                var weaponType1Select = document.getElementById("WeaponType1");
                var weaponType2Select = document.getElementById("WeaponType2");

                weaponType1Select.addEventListener("change", function () {
                    console.log(c(weaponType1Select.value));
                    updateBarGraphs(
                        c(weaponType1Select.value),
                        c(weaponType2Select.value),
                        [
                            "2WD",
                            "Tread",
                            "4WD",
                            "Shuffler",
                            "8WD",
                            "Bristle Drive",
                            "Swerve",
                            "Drive",
                        ],
                        ["30lb", "12lb", "3lb"]
                    );
                });

                weaponType2Select.addEventListener("change", function () {
                    updateBarGraphs(
                        c(weaponType1Select.value),
                        c(weaponType2Select.value),
                        [
                            "2WD",
                            "Tread",
                            "4WD",
                            "Shuffler",
                            "8WD",
                            "Bristle Drive",
                            "Swerve",
                            "Drive",
                        ],
                        ["30lb", "12lb", "3lb"]
                    );
                });
            });
        </script> -->
        <script>
            function c(filePath) {
                // Split the file path by backslash ("\") and get the last part
                var parts = filePath.split("\\");
                var weaponName = parts[parts.length - 1].replace(".gif", ""); // Remove the file extension if needed
                return weaponName.replace("final ", ""); // Remove "final" from the weapon name
            }

            document.addEventListener("DOMContentLoaded", function () {
                var weaponType1Select = document.getElementById("WeaponType1");
                var weaponType2Select = document.getElementById("WeaponType2");

                weaponType1Select.addEventListener("change", function () {
                    console.log(c(weaponType1Select.value));
                    window.update(
                        c(weaponType1Select.value),
                        c(weaponType2Select.value),
                        [
                            "2WD",
                            "Tread",
                            "4WD",
                            "Shuffler",
                            "8WD",
                            "Bristle Drive",
                            "Swerve",
                            "Drive",
                        ],
                        ["30lb", "12lb", "3lb"]
                    )
                    .then((data) => {console.log("1")})
                    .then(() => { console.log('2')});
                });

                weaponType2Select.addEventListener("change", function () {
                    window.update(
                        c(weaponType1Select.value),
                        c(weaponType2Select.value),
                        [
                            "2WD",
                            "Tread",
                            "4WD",
                            "Shuffler",
                            "8WD",
                            "Bristle Drive",
                            "Swerve",
                            "Drive",
                        ],
                        ["30lb", "12lb", "3lb"]
                    );
                });
            });
        </script>
    </head>

    <body>



        <!-- all the divs for main visuals -->
        <div id="main">
            <div class="vbox" id="graph-gifs-and-pi-charts">
                <div class="hbox" id="graphs">
                    <div id="barGraph1">
                        <label for="WeaponType1">Choose a Weapon Type:</label>
                        <select name="WeaponType1" id="WeaponType1">
                            <option value=".\animation\final Hammersaw.gif">Hammersaw</option>
                            <option value=".\animation\final Vertical Spinner.gif">
                                Vertical Spinner
                            </option>
                            <option value=".\animation\final Drum.gif">Drum</option>
                            <option value=".\animation\final Undercutter.gif">Undercutter</option>
                            <option value=".\animation\final Midcutter.gif">Midcutter</option>
                            <option value=".\animation\final Grappler.gif">Grappler</option>
                            <option value=".\animation\final Flamethrower.gif">Flamethrower</option>
                            <option value=".\animation\final Drum Spinner.gif">Drum Spinner</option>
                            <option value=".\animation\final Beater.gif">Beater</option>
                            <option value=".\animation\final Hammer.gif">Hammer</option>
                            <option value=".\animation\final Full Body Spinner.gif">
                                Full Body Spinner
                            </option>
                            <option value=".\animation\final Flipper.gif">Flipper</option>
                            <option value=".\animation\final Shell Spinner.gif">
                                Shell Spinner
                            </option>
                            <option value=".\animation\final Lifter.gif">Lifter</option>
                            <option value=".\animation\final Overhead.gif">Overhead</option>
                            <option value=".\animation\final MeltyBrain.gif">MeltyBrain</option>
                            <option value=".\animation\final Horizontal Spinmer.gif">
                                Horizontal Spinmer
                            </option>
                            <option value=".\animation\final Crusher.gif">Crusher</option>
                            <option value=".\animation\final Thwack.gif">Thwack</option>
                            <option value=".\animation\final Ring Spinner.gif">Ring Spinner</option>
                            <option value=".\animation\final Hammer Saw.gif">Hammer Saw</option>
                            <option value=".\animation\final Flail.gif">Flail</option>
                        </select>
                    </div>
                    <div id="barGraph2">
                        <label for="WeaponType2">Choose a Weapon Type:</label>
                        <select name="WeaponType2" id="WeaponType2">
                            <option value=".\animation\final Hammersaw.gif">Hammersaw</option>
                            <option value=".\animation\final Vertical Spinner.gif">
                                Vertical Spinner
                            </option>
                            <option value=".\animation\final Drum.gif">Drum</option>
                            <option value=".\animation\final Undercutter.gif">Undercutter</option>
                            <option value=".\animation\final Midcutter.gif">Midcutter</option>
                            <option value=".\animation\final Grappler.gif">Grappler</option>
                            <option value=".\animation\final Flamethrower.gif">Flamethrower</option>
                            <option value=".\animation\final Drum Spinner.gif">Drum Spinner</option>
                            <option value=".\animation\final Beater.gif">Beater</option>
                            <option value=".\animation\final Hammer.gif">Hammer</option>
                            <option value=".\animation\final Full Body Spinner.gif">
                                Full Body Spinner
                            </option>
                            <option value=".\animation\final Flipper.gif">Flipper</option>
                            <option value=".\animation\final Shell Spinner.gif">
                                Shell Spinner
                            </option>
                            <option value=".\animation\final Lifter.gif">Lifter</option>
                            <option value=".\animation\final Overhead.gif">Overhead</option>
                            <option value=".\animation\final MeltyBrain.gif">MeltyBrain</option>
                            <option value=".\animation\final Horizontal Spinmer.gif">
                                Horizontal Spinmer
                            </option>
                            <option value=".\animation\final Crusher.gif">Crusher</option>
                            <option value=".\animation\final Thwack.gif">Thwack</option>
                            <option value=".\animation\final Ring Spinner.gif">Ring Spinner</option>
                            <option value=".\animation\final Hammer Saw.gif">Hammer Saw</option>
                            <option value=".\animation\final Flail.gif">Flail</option>
                        </select>
                    </div>
                </div>

                <div class="hbox" id="gif">gif</div>

                <div class="hbox" id="pi-charts">
                    <div class="vbox" id="chart-and-label-1">
                        <!-- Container for the pie chart -->
                        <div id="pie-1"></div>
                        <p id="label-1">label 1</p>
                    </div>
                    <div class="vbox" id="chart-and-label-2">
                        <div id="pie-2"></div>
                        <p id="label-2">label 2</p>
                    </div>
                </div>



            </div>


            <div id="drive-toggles">
                <h2 id="drive-title">Drive System</h2>
                <div class="vbox">
                    <input type="checkbox" id="4WD" class="checkbox" />
                    <label for="4WD" class="switch"></label>
                    <p id="toggle-labels">4WD</p>
                </div>

                <div class="vbox">
                    <input type="checkbox" id="2WD" class="checkbox" />
                    <label for="2WD" class="switch"></label>
                    <p id="toggle-labels">2WD</p>
                </div>

                <div class="vbox">
                    <input type="checkbox" id="Shuffler" class="checkbox" />
                    <label for="Shuffler" class="switch"></label>
                    <p id="toggle-labels">Shuffler</p>
                </div>

                <div class="vbox">
                    <input type="checkbox" id="Other" class="checkbox" />
                    <label for="Other" class="switch"></label>
                    <p id="toggle-labels">Other</p>
                </div>

                <div class="vbox">
                    <input type="checkbox" id="All" class="checkbox" />
                    <label for="All" class="switch"></label>
                    <p id="toggle-labels">All</p>
                </div>
            </div>

            <div id="weight-toggles">
                <h2 id="weight-title">Weight Class</h2>

                <div class="vbox">
                    <input type="checkbox" id="30lb" class="checkbox" />
                    <label for="30lb" class="switch"></label>
                    <p id="toggle-labels">30 lb</p>
                </div>

                <div class="vbox">
                    <input type="checkbox" id="12lb" class="checkbox" />
                    <label for="12lb" class="switch"></label>
                    <p id="toggle-labels">12 lb</p>
                </div>

                <div class="vbox">
                    <input type="checkbox" id="3lb" class="checkbox" />
                    <label for="3lb" class="switch"></label>
                    <p id="toggle-labels">3 lb</p>
                </div>

                <div class="vbox">
                    <input type="checkbox" id="All" class="checkbox" />
                    <label for="All" class="switch"></label>
                    <p id="toggle-labels">All</p>
                </div>
            </div>
            <script type="module" src="scripts/csvReader.js"></script>
            <script type="module" src="scripts/barGraph.js"></script>
            <script type="module" src="scripts/pieGraph1.js"></script>
            <script type="module" src="scripts/pieGraph2.js"></script>
        </div>
    </body>



</div>